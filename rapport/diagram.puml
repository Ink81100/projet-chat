@startuml

top to bottom direction
skinparam classAttributeIconSize 0

package "com.projetchat.client.controlleur" {
  class BulleMessage {
  }
  
  class ContrClient {
    - client: Client
    - ecouteThread: Thread
    - nomField: TextField
    - ipField: TextField
    - portSpinner: Spinner<Integer>
    - textFieldEnvois: TextField
    - messagesScroll: ScrollPane
    - messagesVBox: VBox
    - salonList: ListView<String>
    - createSalonButton: Button
    ---
    - startClient(): void
    - envoyerCommande(String, String): void
    - initEcoute(): void
    - envoisServeur(): void
    - creerSalon(): void
    - bye(): void
    + initialize(URL, ResourceBundle): void
  }
  
  class EcouteHandler {
    - input: BufferedReader
    - messagesScroll: ScrollPane
    - messagesVBox: VBox
    - listView: ListView<String>
    - client: Client
    - key: SecretKey
    ---
    + run(): void
    - recois(String): String
  }
}

package "com.projetchat.client.modele" {
  class Client {
    - nom: String
    - adresse: String
    - port: int
    - key: SecretKey
    - socket: Socket
    - output: PrintWriter
    - input: BufferedReader
    ---
    + Client(String, String, int)
    + start(): void
    + close(): void
    - diffie(): void
    + envois(String): void
    + envois(Message): void
    + getNom(): String
    + getKey(): SecretKey
    + getSocket(): Socket
  }
}

package "com.projetchat.client.vue" {
  class ClientViewer {
    + start(Stage): void
    + main(String[]): void
  }
}

package "com.projetchat.client" {
  class Main {
    + main(String[]): void
  }
}

package "com.projetchat.serveur.controleur" {
  class ContrServeur {
    - logger: Logger
    - serveur: Serveur
    - spinnerPort: Spinner<Integer>
    - startButton: Button
    - sendButton: Button
    - textAreaConsole: TextArea
    - textFieldEnvois: TextField
    ---
    + initialize(URL, ResourceBundle): void
    - envoisServeur(): void
    - startServer(): void
  }
  
  class TextAreaAppender {
    - textArea: TextArea
    ---
    + TextAreaAppender(String, Filter, Layout<Serializable>, boolean, Property[])
    + setTextArea(TextArea): void
    + append(LogEvent): void
    + createAppender(String, Layout<Serializable>, Filter, boolean): TextAreaAppender? 
  }
}

package "com.projetchat.serveur.modele" {
  class ClientHandler {
    - logger: Logger
    - salons: Map<String, Set<ClientHandler>>
    - socket: Socket
    - key: SecretKey
    - input: BufferedReader
    - output: PrintWriter
    - clientsThread: Set<ClientHandler>
    - clientName: String
    - salon: String
    ---
    + ClientHandler(Socket)
    + run(): void
    + getClientName(): String
    - envoisMessageSalon(Message): void
    - envoisSalons(): void
    - close(): void
    - diffie(): void
    - envois(Message): void
    - recois(String): String
    # broadcast(Message): void
  }
  
  class DBHandler {
    - logger: Logger
    - url: String
    ---
    + creerDB(): void
    + isInit(): boolean
    + addMessage(Message): void
    + size(): int
    + setUrl(String): void
  }
  
  class Serveur {
    - logger: Logger
    - port: int
    ---
    + Serveur(int)
    + broadcast(Message): void
    + run(): void
    - start(): void
  }
}

package "com.projetchat.serveur.vue" {
  class ServeurViewer {
    + start(Stage): void
    + main(String[]): void
  }
}

package "com.projetchat.serveur" {
  class Main {
    + main(String[]): void
  }
}

package "com.projetchat" {
  class Message {
    - type: Type
    - utilisateur: String
    - contenu: String
    - date: LocalDateTime
    ---
    + Message(Type, String, String)
    + Message(Type, String, String, LocalDateTime)
    + getType(): Type
    + getUtilisateur(): String
    + getContenu(): String
    + getDate(): LocalDateTime
    + fromJson(String): Message
    + toJson(): String
    + equals(Object): boolean
    + toString(): String
  }
  
  class CryptoHandler {
    + crypte(String, SecretKey): byte[]
    + decrypte(byte[], SecretKey): String
    + verifSign(byte[], byte[], PublicKey): boolean
  }
  
  enum Type {
    ANNONCE
    COMMAND
    LISTUSER
    LISTSALON
    MESSAGE
    ---
    + values(): Type[]
    + valueOf(String): Type
  }
}

' --- Relationships ---
ClientHandler     -[#595959,dashed]->  Message          : "«create»"
ContrClient       -[#595959,dashed]->  Client           : "«create»"
ContrClient      "1" *-[#595959,plain]-> "client\n1" Client           
ContrClient       -[#595959,dashed]->  EcouteHandler    : "«create»"
ContrClient       -[#595959,dashed]->  Message          : "«create»"
ContrServeur      -[#595959,dashed]->  Message          : "«create»"
ContrServeur      -[#595959,dashed]->  Serveur          : "«create»"
ContrServeur     "1" *-[#595959,plain]-> "serveur\n1" Serveur          
EcouteHandler     -[#595959,dashed]->  BulleMessage     : "«create»"
EcouteHandler    "1" *-[#595959,plain]-> "client\n1" Client           
Message          "1" *-[#595959,plain]-> "type\n1" Type             
Serveur           -[#595959,dashed]->  ClientHandler    : "«create»"
Type              +-[#820000,plain]-  Message          
Client            -[#595959,dashed]->  CryptoHandler    : "uses"
ClientHandler     -[#595959,dashed]->  CryptoHandler    : "uses"
EcouteHandler     -[#595959,dashed]->  CryptoHandler    : "uses"
Serveur           -[#595959,dashed]->  DBHandler        : "uses"

@enduml